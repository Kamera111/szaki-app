<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<title>SzakiChat ‚Äì Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    body {
        margin:0;
        font-family:Arial, sans-serif;
        background:#f2f2f2;
    }

    header {
        background:#222;
        color:white;
        padding:18px;
        text-align:center;
        font-size:22px;
        font-weight:bold;
    }

    .container {
        max-width:800px;
        margin:20px auto;
        padding:10px;
    }

    .userBox {
        background:white;
        padding:14px;
        margin-bottom:14px;
        border-radius:10px;
        box-shadow:0 2px 10px rgba(0,0,0,0.1);
    }

    .titleRow {
        display:flex;
        justify-content:space-between;
        align-items:center;
    }

    .role {
        font-size:14px;
        padding:4px 8px;
        border-radius:6px;
        color:white;
    }

    .szaki { background:#007aff; }
    .user { background:#ff9500; }

    .online {
        color:#00c200;
        font-weight:bold;
    }

    .offline {
        color:#777;
    }

    button {
        padding:8px 12px;
        border:none;
        background:#d60000;
        color:white;
        border-radius:8px;
        cursor:pointer;
        margin-top:8px;
    }

    button:hover {
        background:#b30000;
    }

    #logoutBtn {
        background:#555;
        margin-top:20px;
        width:100%;
    }

</style>
</head>

<body>

<header>Admin Panel</header>

<div class="container">
    <h2>Felhaszn√°l√≥k list√°ja</h2>
    <div id="usersList">Bet√∂lt√©s...</div>

    <button id="logoutBtn">Admin kil√©p√©s</button>
</div>


<!-- FIREBASE SCRIPT -->
<script type="module">
import { auth, db } from "./firebase-config.js";

import {
    onAuthStateChanged,
    signOut
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

import {
    collection,
    onSnapshot,
    deleteDoc,
    doc
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";


// ===============================
// ADMIN ELLEN≈êRZ√âS
// ===============================
onAuthStateChanged(auth, async (user) => {
    if (!user) return window.location.href = "login.html";

    // Felt√©telezz√ºk: admin UID = els≈ë regisztr√°lt szaki, k√©s≈ëbb √°ll√≠tjuk fixre!
    if (user.email !== "szakichat@gmail.com") {
        alert("Nincs admin jogosults√°god!");
        window.location.href = "index.html";
        return;
    }

    loadUsers();
});


// ===============================
// FELHASZN√ÅL√ìK LIST√ÅJA REALTIME
// ===============================
function loadUsers() {
    const listDiv = document.getElementById("usersList");

    onSnapshot(collection(db, "users"), (snap) => {
        listDiv.innerHTML = "";

        snap.forEach(docu => {
            const d = docu.data();

            const roleClass = d.role === "szaki" ? "szaki" : "user";
            const onlineClass = d.online ? "online" : "offline";

            listDiv.innerHTML += `
                <div class="userBox">
                    <div class="titleRow">
                        <div>
                            <b>${d.name || "N√©v nincs"}</b>
                            <span class="${roleClass} role">${d.role}</span>
                        </div>
                        <span class="${onlineClass}">
                            ${d.online ? "üü¢ online" : "‚ö™ offline"}
                        </span>
                    </div>

                    <p><b>Email:</b> ${d.email || "-"}</p>
                    <p><b>V√°ros:</b> ${d.city || "-"}</p>
                    <p><b>Szakma:</b> ${d.szakma || "-"}</p>
                    <p><b>Telefonsz√°m:</b> ${d.phone || "-"}</p>

                    <button onclick="deleteUser('${docu.id}')">Felhaszn√°l√≥ t√∂rl√©se</button>
                </div>
            `;
        });
    });
}


// ===============================
// ADMIN: FELHASZN√ÅL√ì T√ñRL√âS
// ===============================
window.deleteUser = async function(uid) {
    if (!confirm("Biztosan t√∂rl√∂d a felhaszn√°l√≥t?")) return;

    await deleteDoc(doc(db, "users", uid));

    alert("Felhaszn√°l√≥ t√∂r√∂lve.");
};


// ===============================
// ADMIN KIL√âP√âS
// ===============================
document.getElementById("logoutBtn").onclick = async () => {
    await signOut(auth);
    window.location.href = "login.html";
};
</script>

</body>
</html>
