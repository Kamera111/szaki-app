<!-- [1/3 - START] -->
<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8" />
    <title>Munka r√©szletei ‚Äì Szaki-App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f2f2f2;
            margin: 0;
            padding: 30px 10px;
        }
        .wrapper {
            max-width: 900px;
            margin: 0 auto 40px;
            background: #ffffff;
            border-radius: 12px;
            padding: 30px 25px 35px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.06);
        }
        h1 { text-align:center; margin:0 0 6px; }
        .alcim { text-align:center; margin:0 0 25px; color:#666; }
        .summary-box {
            background:#fff8e1;
            border-radius:8px;
            padding:10px 14px;
            font-size:14px;
            margin-bottom:22px;
            border:1px solid #ffe0b2;
        }
        textarea, input[type="text"], input[type="file"], select {
            width:100%; border-radius:6px; border:1px solid #ccc;
            font-size:14px; padding:10px 12px; box-sizing:border-box;
        }
        textarea { min-height:150px; resize:vertical; }
        .textarea-wrapper { position:relative; }
        .char-counter {
            position:absolute; right:8px; bottom:6px;
            font-size:12px; color:#999;
        }
        .chip {
            padding:6px 12px; border-radius:999px;
            border:1px solid #ccc; background:#fafafa;
            cursor:pointer; user-select:none;
        }
        .chip.selected { background:#f57c00; color:#fff; border-color:#f57c00; }
        .fo-gomb {
            width:100%; padding:14px 24px; border-radius:8px;
            background:#f57c00; color:#fff; font-size:16px;
            border:none; cursor:pointer;
        }
        .fo-gomb:hover { background:#e56f00; }
        .back-link { text-align:center; margin-top:16px; }
        .back-link a { color:#f57c00; font-weight:bold; text-decoration:none; }
        .back-link a:hover { text-decoration:underline; }
        .floating-donate {
            position:fixed; right:16px; bottom:16px;
            background:#ff9800; color:#fff;
            padding:10px 16px; border-radius:999px;
            cursor:pointer; z-index:9999;
            box-shadow:0 3px 8px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
<!-- [1/3 - END] -->

<!-- [2/3 - START] -->
<div class="wrapper">
    <h1>Munka r√©szletei</h1>
    <p class="alcim">Min√©l r√©szletesebben √≠rod le, ann√°l gyorsabban tal√°lsz megfelel≈ë szakembert.</p>

    <div class="summary-box" id="summaryBox">
        <div><strong>V√°lasztott szakma:</strong> <span id="sumSzakma">nincs megadva</span></div>
        <div><strong>Helysz√≠n:</strong> <span id="sumHelyszin">nincs megadva</span></div>
        <div><strong>Id≈ëz√≠t√©s:</strong> 
            leghamarabb: <span id="sumLH">-</span> ‚Ä¢ 
            legk√©s≈ëbb: <span id="sumLK">-</span> ‚Ä¢ 
            hat√°rid≈ë: <span id="sumHat">-</span>
        </div>
        <div><strong>Munka nagys√°ga:</strong> <span id="sumMeret">nincs megadva</span></div>
    </div>
    <!-- 1. r√©sz: r√©szletes le√≠r√°s -->
    <div>
        <div class="section-title">1. A munka r√©szletes le√≠r√°sa</div>
        <div class="section-subtitle">√çrd le r√©szletesen a munk√°t (minimum 300 karakter).</div>

        <div class="textarea-wrapper">
            <div id="micButton" class="mic-button" title="Dikt√°l√°s ind√≠t√°sa / le√°ll√≠t√°sa">üé§</div>

            <textarea id="reszletesLeiras"
                placeholder="Pl.: 40 m¬≤ nappali padl√≥ burkol√°sa, 15 m¬≤ konyha fal csempe, parkol√°s, emelet, lift van-e, r√©gi burkolat bont√°sa, stb."></textarea>

            <div id="charCounter" class="char-counter">0 / 300</div>
        </div>
    </div>

    <!-- 3. Milyen szakemberek -->
    <div>
        <div class="section-title">3. Milyen szakemberek kellenek?</div>
        <div class="chips-container" id="szakmaChips">
            <div class="chip" data-value="K≈ëm≈±ves">K≈ëm≈±ves</div>
            <div class="chip" data-value="Szobafest≈ë-tap√©t√°z√≥">Szobafest≈ë-tap√©t√°z√≥</div>
            <div class="chip" data-value="Burkol√≥">Burkol√≥</div>
            <div class="chip" data-value="Hidegburkol√≥">Hidegburkol√≥</div>
            <div class="chip" data-value="Melegburkol√≥">Melegburkol√≥</div>
            <div class="chip" data-value="Villanyszerel≈ë">Villanyszerel≈ë</div>
            <div class="chip" data-value="V√≠zszerel≈ë">V√≠zszerel≈ë</div>
            <div class="chip" data-value="G√°zszerel≈ë">G√°zszerel≈ë</div>
            <div class="chip" data-value="F≈±t√©sszerel≈ë">F≈±t√©sszerel≈ë</div>
            <div class="chip" data-value="Gipszkartonos">Gipszkartonos</div>
            <div class="chip" data-value="Kl√≠maszerel≈ë">Kl√≠maszerel≈ë</div>
        </div>

        <div class="checkbox-row">
            <input type="checkbox" id="teljesFelujitas">
            <label for="teljesFelujitas">Teljes lak√°sfel√∫j√≠t√°st szeretn√©k</label>
        </div>
    </div>

    <!-- 4. K√©pfelt√∂lt√©s -->
    <div>
        <div class="section-title">4. K√©pek</div>
        <input type="file" id="kepek" multiple>
    </div>

    <!-- 5. √År m√≥d -->
    <div>
        <div class="section-title">5. √År-√©rdekl≈ëd√©s m√≥dja</div>

        <label>
            <input type="radio" name="priceMode" value="normal" checked>
            T√©nyleg meg akarom csin√°ltatni a munk√°t.
        </label>

        <label>
            <input type="radio" name="priceMode" value="onlyPrice">
            Csak az √°rakra vagyok k√≠v√°ncsi (t√°j√©koztat√≥ aj√°nlat).
        </label>
    </div>

    <div class="button-row">
        <button class="fo-gomb" id="btnRogzit">Munka r√∂gz√≠t√©se (demo)</button>
    </div>

    <div class="back-link">
        ‚Üê <a href="megrendelo-regisztracio.html" id="visszaLink">Vissza az 1. l√©p√©shez</a>
    </div>

</div>

<div class="floating-donate" onclick="alert('K√∂sz√∂nj√ºk, hogy t√°mogatod az oldalt! ü§ù')">
    ü§ù Becs√ºletkassza / Megoszt√°s
</div>

<!-- [2/3 - END] -->

<!-- [3/3 ‚Äì SCRIPT START] -->
<script type="module">
    import { db } from "./firebase-config.js";
    import { collection, addDoc, serverTimestamp }
    from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    /* ------------------------------
       1) Visszat√∂lt√©s localStorage-b√≥l
    ------------------------------ */
    function betoltOsszegzes() {
        const adat = JSON.parse(localStorage.getItem("szaki_megrendelo_alap")) || {};

        document.getElementById("sumSzakma").textContent = adat.szakma || "nincs megadva";
        document.getElementById("sumHelyszin").textContent = adat.varos || "nincs megadva";
        document.getElementById("sumLH").textContent = adat.legkorabbi || "-";
        document.getElementById("sumLK").textContent = adat.legkesobb || "-";
        document.getElementById("sumHat").textContent = adat.hatarido || "-";
        document.getElementById("sumMeret").textContent = adat.munkaMeret || "nincs megadva";
    }

    /* ------------------------------
       2) Visszal√©p√©s el≈ëtt ment√©s
    ------------------------------ */
    document.getElementById("visszaLink").addEventListener("click", (e) => {
        const leiras = document.getElementById("reszletesLeiras").value;
        const szakmak = Array.from(document.querySelectorAll(".chip.selected"))
                      .map(c => c.dataset.value);

        const adat2 = {
            leiras,
            szakmak,
            teljes: document.getElementById("teljesFelujitas").checked,
            arMod: document.querySelector("input[name='priceMode']:checked").value
        };

        localStorage.setItem("szaki_megrendelo_lepes2", JSON.stringify(adat2));
    });

    /* ------------------------------
       3) Karaktersz√°ml√°l√≥
    ------------------------------ */
    const textarea = document.getElementById("reszletesLeiras");
    const counter = document.getElementById("charCounter");

    textarea.addEventListener("input", () => {
        const len = textarea.value.length;
        counter.textContent = len + " / 300";
        counter.style.color = len < 300 ? "red" : "#999";
    });

    /* ------------------------------
       4) Chip kiv√°laszt√°s
    ------------------------------ */
    document.getElementById("szakmaChips").addEventListener("click", (e) => {
        const chip = e.target.closest(".chip");
        if (!chip) return;
        chip.classList.toggle("selected");
    });

    /* ------------------------------
       5) Ment√©s Firestore-ba (demo)
    ------------------------------ */
    async function mentFireStore() {
        const leiras = textarea.value.trim();
        if (leiras.length < 300) {
            alert("Legal√°bb 300 karakter kell!");
            return;
        }

        const szakmak = Array.from(document.querySelectorAll(".chip.selected"))
                             .map(c => c.dataset.value);
        const teljes = document.getElementById("teljesFelujitas").checked;
        const arMod = document.querySelector("input[name='priceMode']:checked").value;

        const alap = JSON.parse(localStorage.getItem("szaki_megrendelo_alap")) || {};

        const adat = {
            ...alap,
            leiras,
            szakmak,
            teljes,
            arMod,
            createdAt: serverTimestamp()
        };

        const ref = await addDoc(collection(db, "workRequests"), adat);

        alert("Mentve! Firestore ID: " + ref.id);
    }

    document.getElementById("btnRogzit").addEventListener("click", mentFireStore);

    /* ------------------------------
       6) Bet√∂lt√©s ind√≠t√°skor
    ------------------------------ */
    betoltOsszegzes();
</script>
<!-- [3/3 ‚Äì END] -->

</body>
</html>
