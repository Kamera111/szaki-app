<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8" />
    <title>√öj megrendel≈ë ‚Äì Szaki-App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
        body {
            background: #f5f5f5;
            font-family: Arial, sans-serif;
            padding: 20px;
            margin: 0;
        }
        .box {
            background: white;
            padding: 22px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 650px;
            margin: auto;
        }
        h2 {
            margin: 0 0 12px;
            font-size: 22px;
        }
        input, select {
            width: 100%;
            padding: 13px;
            margin: 12px 0;
            border-radius: 10px;
            border: 1px solid #ccc;
            font-size: 15px;
        }
        button {
            width: 100%;
            padding: 14px;
            font-size: 17px;
            background: #ff8c00;
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
        }
        button:active {
            transform: translateY(1px);
            filter: brightness(0.95);
        }
    </style>
</head>
<body>

<div class="box">
    <h2>√öj megrendel≈ë ‚Äì 1. l√©p√©s</h2>
    <p style="font-size:13px; margin-top:-4px; color:#666;">
        Add meg az alapadatokat, majd tov√°bb l√©phetsz a munka r√©szleteihez.
    </p>

    <input id="nev" type="text" placeholder="Teljes neved" />
    <input id="elerhetoseg" type="text" placeholder="Telefonsz√°m / Email" />
    <input id="varos" type="text" placeholder="V√°ros / Ker√ºlet (pl.: Budapest, XIII.)" />

    <select id="szakma">
        <option value="">V√°lassz szakm√°t</option>
        <option value="K≈ëm≈±ves">K≈ëm≈±ves</option>
        <option value="Fest≈ë">Fest≈ë</option>
        <option value="Burkol√≥">Burkol√≥</option>
        <option value="Gipszkartonos">Gipszkartonos</option>
        <option value="Villanyszerel≈ë">Villanyszerel≈ë</option>
        <option value="V√≠zszerel≈ë">V√≠zszerel≈ë</option>
        <option value="G√°zszerel≈ë">G√°zszerel≈ë</option>
        <option value="F≈±t√©sszerel≈ë">F≈±t√©sszerel≈ë</option>
        <option value="Kl√≠maszerel≈ë">Kl√≠maszerel≈ë</option>
    </select>

    <label style="font-size:14px; margin-top:8px;">Munka v√°rhat√≥ m√©rete</label>
    <select id="meret">
        <option value="">V√°lassz m√©retet</option>
        <option value="1 napos kisebb munka">1 napos kisebb munka</option>
        <option value="1‚Äì3 napos k√∂zepes munka">1‚Äì3 napos k√∂zepes munka</option>
        <option value="T√∂bb napos nagy munka">T√∂bb napos nagy munka</option>
        <option value="Nagy projekt / Lak√°sfel√∫j√≠t√°s">Nagy projekt / Teljes fel√∫j√≠t√°s</option>
    </select>

    <button onclick="lepes2()">Tov√°bb a r√©szletekhez</button>
</div>

<script type="module">
    import { db } from "./firebase-config.js";
    import { setDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    async function lepes2() {

        const nev = document.getElementById("nev").value.trim();
        const eler = document.getElementById("elerhetoseg").value.trim();
        const varos = document.getElementById("varos").value.trim();
        const szakma = document.getElementById("szakma").value;
        const meret = document.getElementById("meret").value;

        if (!nev || !eler || !varos || !szakma || !meret) {
            alert("K√©rlek t√∂lts ki minden mez≈ët!");
            return;
        }

        // üî• ADATOK MENT√âSE LOCAL STORAGE-BE (2. l√©p√©shez tov√°bbvitel)
        localStorage.setItem("mr_nev", nev);
        localStorage.setItem("mr_elerhetoseg", eler);
        localStorage.setItem("mr_varos", varos);
        localStorage.setItem("mr_szakma", szakma);
        localStorage.setItem("mr_meret", meret);

        // üî• FIRESTORE: megrendel≈ë alapszint≈± adatlap l√©trehoz√°sa
        try {
            const id = nev.toLowerCase().replace(/[^a-z0-9]/g, "") + "_" + Date.now();

            await setDoc(doc(db, "megrendelok", id), {
                nev,
                elerhetoseg: eler,
                varos,
                szakmaFo: szakma,
                meret,
                createdAt: serverTimestamp(),
                status: "alapadatok_kesz"  // k√©s≈ëbb a 2. l√©p√©s √°llapotot friss√≠ti
            });

            console.log("Megrendel≈ë mentve Firestore-ba:", id);

        } catch (err) {
            console.error("Firestore hiba:", err);
            alert("Hiba t√∂rt√©nt az adatok ment√©sekor.");
            return;
        }

        // üî• TOV√ÅBBL√âP√âS a r√©szletes 2. l√©p√©shez:
        window.location.href = "munka-reszletei.html";
    }
</script>

</body>
</html>
