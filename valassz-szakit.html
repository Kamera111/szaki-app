<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8" />
    <title>Válassz szakembert – Szaki-App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
        body { margin:0; padding:0; font-family:Arial, sans-serif; background:#f5f5f5; }
        header { background:#ff8c00; color:#fff; padding:16px; text-align:center; font-size:20px; font-weight:bold; }
        .container { max-width:900px; margin:0 auto; padding:16px; }
        .card {
            background:#fff; padding:16px; margin-bottom:14px;
            border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.08);
        }
        .name { font-size:18px; font-weight:bold; }
        .prof { font-size:14px; color:#666; margin-top:4px; }
        .buttons { display:flex; gap:10px; margin-top:12px; }
        .btn {
            flex:1; padding:10px; border:none; border-radius:8px;
            font-size:14px; font-weight:bold; cursor:pointer;
        }
        .btn-profile { background:#007bff; color:white; }
        .btn-chat { background:#28a745; color:white; }
        .info-box {
            background:white; padding:14px 16px; border-radius:10px;
            box-shadow:0 2px 8px rgba(0,0,0,0.08);
            margin-bottom:16px; font-size:14px; line-height:1.4;
        }
    </style>
</head>

<body>

<header>Válassz szakembert</header>

<div class="container">

    <div class="info-box" id="info"></div>

    <div id="lista"></div>

</div>

<script type="module">

    import { db } from "./firebase-config.js";
    import {
        collection, getDocs, query, where
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // ─────────────────────────────────────────────
    // URL paraméterek
    // ─────────────────────────────────────────────
    const params = new URLSearchParams(window.location.search);

    const szakma = params.get("szakma") || "";
    const megrendelonev = params.get("megrendelonev") || "";
    const orderId = params.get("orderId") || "";

    document.getElementById("info").innerHTML = `
        <b>Megrendelő:</b> ${megrendelonev || "Nincs megadva"}<br>
        <b>Keresett szakma:</b> ${szakma}<br>
        <b>Munka azonosító:</b> ${orderId || "-"}
    `;

    // ─────────────────────────────────────────────
    // Firestore lekérés
    // ─────────────────────────────────────────────
    const lista = document.getElementById("lista");

    async function loadWorkers() {

        if (!szakma) {
            lista.innerHTML = "<p>Nincs megadva szakma.</p>";
            return;
        }

        const q = query(
            collection(db, "workers"),
            where("profession", "array-contains", szakma)
        );

        const snap = await getDocs(q);

        if (snap.empty) {
            lista.innerHTML = "<p>Ehhez a szakmához nincs szakember.</p>";
            return;
        }

        snap.forEach(docu => {
            const d = docu.data();

            const div = document.createElement("div");
            div.className = "card";

            div.innerHTML = `
                <div class="name">${d.name}</div>
                <div class="prof">${d.profession.join(", ")}</div>

                <div class="buttons">
                    <button class="btn btn-profile" onclick="openProfile('${docu.id}')">
                        Profil megtekintése
                    </button>

                    <button class="btn btn-chat" onclick="openChat('${d.name}','${docu.id}')">
                        Chat indítása
                    </button>
                </div>
            `;

            lista.appendChild(div);
        });
    }

    loadWorkers();

    // ─────────────────────────────────────────────
    // Navigációk
    // ─────────────────────────────────────────────
    window.openProfile = function(id) {
        window.location.href =
            `szaki-profil.html?id=${id}&orderId=${orderId}&megrendelonev=${encodeURIComponent(megrendelonev)}`;
    };

    window.openChat = function(workerName, workerId) {
        window.location.href =
            `chat.html?sender=${encodeURIComponent(megrendelonev)}&partner=${encodeURIComponent(workerName)}&orderId=${orderId}&workerId=${workerId}`;
    };

</script>

</body>
</html>
