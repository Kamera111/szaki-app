<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8" />
    <title>V√°lassz szakembert ‚Äì Szaki-App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
        body{
            margin:0; padding:0;
            background:#f5f5f5;
            font-family:Arial, sans-serif;
        }

        header{
            background:#ff8c00;
            color:white;
            text-align:center;
            padding:16px;
            font-size:20px;
            font-weight:bold;
        }

        .container{
            max-width:900px;
            margin:0 auto;
            padding:16px;
        }

        .info-box{
            background:white;
            padding:14px 16px;
            margin-bottom:16px;
            border-radius:10px;
            box-shadow:0 2px 8px rgba(0,0,0,0.08);
            font-size:14px;
        }

        .szaki-card{
            background:white;
            padding:14px 16px;
            margin-bottom:12px;
            border-radius:12px;
            box-shadow:0 2px 10px rgba(0,0,0,0.1);
        }

        .szaki-top{
            display:flex;
            justify-content:space-between;
            align-items:center;
        }

        .szaki-name{
            font-size:18px;
            font-weight:bold;
        }

        .status{
            font-size:13px;
            padding:4px 10px;
            border-radius:20px;
            color:white;
        }

        .online{ background:#28a745; }
        .offline{ background:#777; }

        .lastseen{
            font-size:12px;
            color:#666;
            margin-top:6px;
        }

        .szaki-profession{
            font-size:14px;
            margin-top:4px;
            color:#555;
        }

        .actions{
            display:flex;
            gap:10px;
            margin-top:14px;
        }

        .btn-chat, .btn-choose, .btn-reject{
            flex:1;
            padding:10px;
            border:none;
            border-radius:8px;
            font-weight:bold;
            font-size:14px;
            cursor:pointer;
            color:white;
        }

        .btn-chat{ background:#007bff; }
        .btn-choose{ background:#28a745; }
        .btn-reject{ background:#c00; }

        .ads-box{
            background:#fff7e6;
            padding:15px;
            border-radius:10px;
            text-align:center;
            margin:20px 0;
            font-size:14px;
            border:1px dashed #ff8c00;
            color:#333;
        }
    </style>
</head>

<body>

<header>V√°lassz szakembert</header>

<div class="container">

    <div id="info-box" class="info-box"></div>
    <div class="ads-box">üî∂ Rekl√°m hely (Google Ads / saj√°t banner)</div>
    <div id="szaki-lista"></div>

</div>

<!-- Szaki alapadatok -->
<script src="szaki-adatok.js"></script>

<!-- Firebase -->
<script type="module">

import { db } from "./firebase-config.js";
import { collection, query, where, getDocs } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";


// --------------------------------------------------
// PARAM√âTEREK
// --------------------------------------------------
const params = new URLSearchParams(window.location.search);

const megrendelonev = params.get("megrendelonev") || localStorage.getItem("mr_nev") || "";
const szakma = params.get("szakma") || localStorage.getItem("mr_szakma") || "";
const orderId = params.get("orderId") || null;

document.getElementById("info-box").innerHTML = `
    <b>Megrendel≈ë:</b> ${megrendelonev}<br>
    <b>Keresett szakma:</b> ${szakma}<br>
    <b>Munka azonos√≠t√≥:</b> ${orderId}
`;


// --------------------------------------------------
// √ÅLSZAKI GENER√ÅTOR
// --------------------------------------------------
function generateFakeWorkersForProfession(prof) {

    const fakeNames = [
        "S. B√©la", "K. Andr√°s", "M. J√≥zsef", "P. Attila", "T. Norbert",
        "√Å. Csaba", "V. L√°szl√≥", "D. R√≥bert", "H. Gerg≈ë", "R. Patrik",
        "F. Bence", "O. Zolt√°n", "L. D√°vid"
    ];

    const list = [];

    // k√©t online:
    for (let i = 0; i < 2; i++) {
        list.push({
            name: fakeNames[Math.floor(Math.random()*fakeNames.length)],
            profession: prof,
            isOnline: true,
            lastSeenMinutes: 0
        });
    }

    // t√∂bbi offline (5 db)
    for (let i = 0; i < 5; i++) {
        list.push({
            name: fakeNames[Math.floor(Math.random()*fakeNames.length)],
            profession: prof,
            isOnline: false,
            lastSeenMinutes: Math.floor(Math.random()*45)+5   // 5‚Äì50 perc
        });
    }

    return list;
}


// --------------------------------------------------
// SZAKIK BET√ñLT√âSE
// --------------------------------------------------
async function loadWorkers() {
    const list = document.getElementById("szaki-lista");
    list.innerHTML = "Bet√∂lt√©s...";

    let realWorkers = [];

    try {
        const q = query(collection(db, "szakik"), where("profession", "==", szakma));
        const snap = await getDocs(q);

        snap.forEach(d => realWorkers.push(d.data()));

    } catch (e) {
        console.error(e);
    }

    // fallback (ha Firestore √ºres)
    if (realWorkers.length === 0) {
        realWorkers = window.SzakiAdatok.findByProfession(szakma);
    }

    const fakeWorkers = generateFakeWorkersForProfession(szakma);
    const allWorkers = [...realWorkers, ...fakeWorkers];

    // kirajzol√°s
    list.innerHTML = "";
    allWorkers.forEach(w => renderCard(w));
}


// --------------------------------------------------
// SZAKI K√ÅRTYA
// --------------------------------------------------
function renderCard(sz) {
    const list = document.getElementById("szaki-lista");

    const card = document.createElement("div");
    card.className = "szaki-card";

    const onlineLabel = sz.isOnline
        ? `<span class="status online">üü¢ online</span>`
        : `<span class="status offline">‚ö´ offline</span>`;

    const lastSeen = !sz.isOnline
        ? `<div class="lastseen">Utolj√°ra akt√≠v: ${sz.lastSeenMinutes} perce</div>`
        : "";

    card.innerHTML = `
        <div class="szaki-top">
            <div class="szaki-name">${sz.name}</div>
            ${onlineLabel}
        </div>

        <div class="szaki-profession">${sz.profession}</div>
        ${lastSeen}

        <div class="actions">
            <button class="btn-chat">Chat</button>
            <button class="btn-choose">Ezt v√°lasztom</button>
            <button class="btn-reject">M√°sik szaki kell</button>
        </div>
    `;

    // CHAT gomb ‚Üí chat.html (AI kezeli az √°l-szakit)
    card.querySelector(".btn-chat").onclick = () => {
        window.location.href =
            `chat.html?sender=${encodeURIComponent(megrendelonev)}&partner=${encodeURIComponent(sz.name)}&orderId=${orderId}`;
    };

    card.querySelector(".btn-choose").onclick = () => {
        alert(`Kiv√°lasztottad: ${sz.name}`);
    };

    card.querySelector(".btn-reject").onclick = () => {
        alert(`Elutas√≠tva: ${sz.name}`);
    };

    list.appendChild(card);
}


// --------------------------------------------------
// START
// --------------------------------------------------
loadWorkers();

</script>

</body>
</html>
