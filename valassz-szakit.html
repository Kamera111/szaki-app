<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8" />
    <title>Válassz szakembert – Szaki-App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
        body { margin:0; padding:0; font-family:Arial,sans-serif; background:#f5f5f5; }
        header {
            background:#ff8c00; color:#fff; padding:16px;
            text-align:center; font-size:20px; font-weight:bold;
        }
        .container { max-width:900px; margin:0 auto; padding:16px; }

        .info-box{
            background:#fff; padding:14px 16px; border-radius:10px;
            box-shadow:0 2px 8px rgba(0,0,0,0.08); margin-bottom:16px;
            font-size:14px; line-height:1.4;
        }
        .share-main-btn{
            display:block; width:100%; margin-top:10px; padding:12px;
            border-radius:10px; border:none; cursor:pointer;
            background:#ff8c00; color:#fff; font-size:16px; font-weight:bold;
        }

        .profession-title{
            font-size:18px; font-weight:bold; margin:18px 0 12px; color:#333;
        }

        .szaki-card{
            background:#fff; border-radius:12px; padding:14px 16px;
            box-shadow:0 2px 10px rgba(0,0,0,0.08); margin-bottom:14px;
        }

        .szaki-header-line{
            display:flex; justify-content:space-between; gap:12px; align-items:baseline;
        }
        .szaki-name{ font-size:17px; font-weight:bold; color:#222; }

        .szaki-badge{
            font-size:11px; padding:3px 8px; border-radius:999px;
            background:#ffe6bf; color:#8a4b00; white-space:nowrap;
        }

        .szaki-profession{ font-size:13px; color:#555; margin-top:4px; }
        .szaki-note{ font-size:13px; color:#444; margin-top:6px; }

        .szaki-phone{ font-size:13px; margin-top:6px; }
        .szaki-phone b{ font-weight:bold; }

        .szaki-email{ font-size:13px; margin-top:4px; color:#333; }
        .szaki-email b{ font-weight:bold; }

        .szaki-holiday{ font-size:12px; color:#555; margin-top:4px; }

        .szaki-status{ font-size:12px; margin-top:4px; }
        .szaki-status.real{ color:#007700; }
        .szaki-status.demo{ color:#aa0000; }

        .szaki-actions{
            display:flex; flex-wrap:wrap; gap:8px; margin-top:10px;
        }

        .btn-chat, .btn-share{
            flex:1 1 130px; padding:9px 8px; border-radius:999px; border:none;
            cursor:pointer; font-size:13px;
        }
        .btn-chat{ background:#28a745; color:#fff; font-weight:bold; }
        .btn-chat.demo-disabled{ background:#ccc; color:#666; cursor:not-allowed; }

        .btn-share{ background:#007bff; color:#fff; }

        .no-result{
            margin-top:24px; font-size:18px; text-align:center; color:#333;
        }
    </style>
</head>
<body>

<header>Válassz szakembert</header>

<div class="container">

    <div class="info-box" id="info-text"></div>

    <div id="szaki-lista"></div>
</div>

<script src="szaki-adatok.js"></script>

<script>
    function normalizeProfession(str) {
        if (!str) return "";
        const lower = str.toLowerCase();
        const map = { "á":"a","é":"e","í":"i","ó":"o","ö":"o","ő":"o","ú":"u","ü":"u","ű":"u" };
        return lower.replace(/[áéíóöőúüű]/g, c => map[c] || c);
    }

    function sharePage() {
        const url = window.location.href;
        const shareData = {
            title: "Szaki-App",
            text: "Nézd meg a szakembereket!",
            url: url
        };
        if (navigator.share) {
            navigator.share(shareData).catch(()=>{});
        } else if (navigator.clipboard) {
            navigator.clipboard.writeText(url);
            alert("Link vágólapra másolva!");
        }
    }

    function openChatWith(szakiName, megrendelonev) {
        const sender = megrendelonev || "Megrendelő";
        const link =
            "chat.html?sender=" + encodeURIComponent(sender) +
            "&partner=" + encodeURIComponent(szakiName);
        window.location.href = link;
    }

    (function renderSzakik(){
        if (!window.SzakiAdatok) {
            document.getElementById("szaki-lista").innerHTML =
                "<p>Hiba: szaki-adatok.js hiányzik</p>";
            return;
        }

        const params = new URLSearchParams(window.location.search);
        const szakmaRaw = params.get("szakma") || "";
        const megrendelonev = params.get("name") || "";

        const info = document.getElementById("info-text");
        info.innerHTML =
            `<b>Megrendelő neve:</b> ${megrendelonev || "–"}<br>
             <b>Keresett szakma:</b> ${szakmaRaw || "–"}<br>
             Válassz egy szakembert!<br>
             <button class="share-main-btn" onclick="sharePage()">MEGOSZTÁS</button>`;

        const all = window.SzakiAdatok.findByProfession(szakmaRaw);
        const getPhone = window.SzakiAdatok.getMaskedPhone;
        const getEmail = window.SzakiAdatok.getMaskedEmail;
        const getHoliday = window.SzakiAdatok.getHolidayLabel;

        const lista = document.getElementById("szaki-lista");
        lista.innerHTML = "";

        if (all.length === 0) {
            lista.innerHTML = `<div class="no-result">Ehhez a szakmához nincs szakember.</div>`;
            return;
        }

        all.sort((a,b)=> (b.priority||0)-(a.priority||0));

        all.forEach(szaki => {
            const card = document.createElement("div");
            card.className = "szaki-card";

            card.innerHTML = `
                <div class="szaki-header-line">
                    <div class="szaki-name">${szaki.name}</div>
                    <div class="szaki-badge">${szaki.isReal ? "Igazolt szakember" : "Naptára betáblázva"}</div>
                </div>

                <div class="szaki-profession">${Array.isArray(szaki.profession) ? szaki.profession.join(", ") : szaki.profession}</div>

                <div class="szaki-note">${szaki.note || ""}</div>

                <div class="szaki-phone"><b>Telefon:</b> ${getPhone(szaki)}</div>

                <div class="szaki-email"><b>Email:</b> ${getEmail(szaki)}</div>

                <div class="szaki-holiday">${getHoliday(szaki)}</div>

                <div class="szaki-status ${szaki.isReal ? "real" : "demo"}">
                    ${szaki.isReal ? "Elérhető – indíts chatet!" : "Nem fogad új munkát"}
                </div>
            `;

            const actions = document.createElement("div");
            actions.className = "szaki-actions";

            const chat = document.createElement("button");
            chat.className = "btn-chat";
            chat.textContent = "Chat indítása";

            if (szaki.isReal) {
                chat.onclick = () => openChatWith(szaki.name, megrendelonev);
            } else {
                chat.disabled = true;
                chat.classList.add("demo-disabled");
            }

            const share = document.createElement("button");
            share.className = "btn-share";
            share.textContent = "Megosztás";
            share.onclick = sharePage;

            actions.appendChild(chat);
            actions.appendChild(share);
            card.appendChild(actions);

            lista.appendChild(card);
        });
    })();
</script>

</body>
</html>
